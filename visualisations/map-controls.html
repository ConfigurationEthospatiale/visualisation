<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Contrôles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  
  </style>
  <link rel="stylesheet" href="../dist/theme/shepherd-style.css">
	<link rel="stylesheet" href="../dist/theme/custom.css">


</head>

<body>
<div class="turnip-normal">
  <label class="decadeOnOff"><input type="checkbox" id="toggleDecadeFilter" checked> Filtrer par
    décennie </label><br><br>
  <label for="decadeSlider">Sélectionner la décennie: </label>
  <input type="range" id="decadeSlider" min="1940" max="2020" step="10" value="2020">
  <span id="decadeLabel">2020</span>

</div>

  <script type="module">
    import Shepherd from 'https://cdn.jsdelivr.net/npm/shepherd.js@13.0.0/dist/esm/shepherd.mjs';

    const tour = new Shepherd.Tour({
      useModalOverlay: true,

    });

    tour.addStep({
      id: 'step1',
      text: 'Cocher pour activer la vue par décennie. ',
      attachTo: {
        element: '.decadeOnOff',
        on: 'bottom'
      },
      buttons: [
        {
          text: 'OK',
          action: tour.next
        }
      ]
    });
    tour.addStep({
      id: 'step2',
      text: 'Glisser pour changer la décennie affichée. ',
      attachTo: {
        element: '.decadeSlider',
        on: 'bottom'
      },
      buttons: [
        {
          text: 'OK',
          action: tour.next
        }
      ]
    });

    tour.start();
  </script>

  <script>
    const slider = document.getElementById("decadeSlider");
    const checkbox = document.getElementById("toggleDecadeFilter");
    const label = document.getElementById("decadeLabel");

    // Load saved settings from localStorage
    window.addEventListener("DOMContentLoaded", () => {
      const savedFiltering = localStorage.getItem("filtering");
      const savedDecade = localStorage.getItem("decade");

      if (savedFiltering !== null) {
        checkbox.checked = savedFiltering === "true";
      }
      if (savedDecade !== null) {
        slider.value = savedDecade;
        label.textContent = savedDecade;
      }

      sendUpdate();
    });

    function sendUpdate() {
      const filtering = checkbox.checked;
      const decade = parseInt(slider.value);
      label.textContent = decade;

      // Save to localStorage
      localStorage.setItem("filtering", filtering);
      localStorage.setItem("decade", decade);

      const mapFrame = parent.document.querySelector('iframe[src*="map.html"]');
      if (mapFrame) {
        mapFrame.contentWindow.postMessage({ filtering, decade }, "*");
      }
    }

    slider.addEventListener("input", sendUpdate);
    checkbox.addEventListener("change", sendUpdate);
  </script>


</body>

</html>

