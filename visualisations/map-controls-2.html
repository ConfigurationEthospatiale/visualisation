<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Filtrage par décennie</title>
    <link rel="stylesheet" href="../dist/theme/shepherd-style.css">
    <link rel="stylesheet" href="../dist/theme/custom.css">

</head>
<body>
  <div class="turnip-normal">
    <label style="  font-size: 16px; margin-bottom: 10px; display: inline-block;" class="decadeOnOff"><input
        type="checkbox" id="toggleDecadeFilter" checked> Filtrer par
      décennie </label>
    <label style="font-size: 16px;" class="decadeSlider">Sélectionner la décennie: </label>
    <input type="range" id="decadeSlider" min="1940" max="2020" step="10" value="2020">
    <span style="font-size: 14px; margin-bottom: 10px; display: inline-block;" id="decadeLabel">2020</span>

    <div style="width: 100%; display: inline-block;">
      <div class="ethos-item"><span class="color-box" style="background-color: #E2B4BD;"></span>Ethos cosmopolite</div>
      <div class="ethos-item"><span class="color-box" style="background-color: #93A8AC;"></span>Ethos d'opposition</div>
      <div class="ethos-item"><span class="color-box" style="background-color: #FFD447;"></span>Ethos de genre</div>
      <div class="ethos-item"><span class="color-box" style="background-color: #3E5622;"></span>Ethos de la migrance
      </div>
      <div class="ethos-item"><span class="color-box" style="background-color: #DB7F67;"></span>Ethos de la présence
      </div>
      <div class="ethos-item"><span class="color-box" style="background-color: #700353;"></span>Ethos environnemental
      </div>
      <div class="ethos-item"><span class="color-box" style="background-color: #345995;"></span>Ethos mémoriel</div>
    </div>
  </div>


  <script>
    const iframe = document.getElementById('questionFrame');

    iframe.addEventListener("load", function () {
      const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;
      const contentHeight = iframeDocument.body.scrollHeight;
      iframe.style.height = contentHeight + "px";
    });
  </script>

  <script type="module">
    import Shepherd from 'https://cdn.jsdelivr.net/npm/shepherd.js@13.0.0/dist/esm/shepherd.mjs';

    const tour = new Shepherd.Tour({
      useModalOverlay: true,

    });

    tour.addStep({
      id: 'step1',
      text: 'Cocher pour activer la vue par décennie. ',
      attachTo: {
        element: '.decadeOnOff',
        on: 'bottom'
      },
      buttons: [
        {
          text: 'OK',
          action: tour.next
        }
      ]
    });
    tour.addStep({
      id: 'step2',
      text: 'Glisser pour changer la décennie affichée. ',
      attachTo: {
        element: '.decadeSlider',
        on: 'bottom'
      },
      buttons: [
        {
          text: 'OK',
          action: tour.next
        }
      ]
    });
    tour.addStep({
      id: 'example-step1',
      text: 'Les ethos sont représentés par des points des couleurs. ',
      attachTo: {
        element: '.turnip-normal',
        on: 'bottom'
      },
      buttons: [
        {
          text: 'OK',
          action: tour.next
        }
      ]
    });

    tour.start();
  </script>
  <script>
    const toggle = document.getElementById("toggleDecadeFilter");
    const slider = document.getElementById("decadeSlider");
    const label = document.getElementById("decadeLabel");
    const mapFrame = document.getElementById("mapFrame");
    const questionFrame = document.getElementById("questionFrame");

    // Initialisation des préférences
    window.addEventListener("DOMContentLoaded", () => {
      const savedFiltering = localStorage.getItem("filtering");
      const savedDecade = localStorage.getItem("decade");

      toggle.checked = savedFiltering === null ? true : savedFiltering === "true";
      slider.value = savedDecade || "2020";
      label.textContent = slider.value;

      sendFilter();
    });

    // Mise à jour dynamique du label et sauvegarde
    slider.addEventListener("input", () => {
      label.textContent = slider.value;
      localStorage.setItem("decade", slider.value);
      sendFilter();
    });

    toggle.addEventListener("change", () => {
      localStorage.setItem("filtering", toggle.checked);
      sendFilter();
    });

    // Envoi du message postMessage à l'iframe contenant "map.html"
    function sendFilter() {
      const message = {
        filtering: toggle.checked,
        decade: parseInt(slider.value)
      };
    window.parent.postMessage({
  type: "decadeFilterUpdate",
  filtering: toggle.checked,
  decade: parseInt(slider.value)
}, "*");
    }

    // Ajustement automatique de la hauteur de questionFrame
    questionFrame.addEventListener("load", () => {
      try {
        const doc = questionFrame.contentDocument || questionFrame.contentWindow.document;
        const newHeight = doc.body.scrollHeight;
        questionFrame.style.height = newHeight + "px";
      } catch (err) {
        console.warn("Redimensionnement échoué (problème de domaine croisé ?)");
      }
    });
  </script>
</body>
</html>



